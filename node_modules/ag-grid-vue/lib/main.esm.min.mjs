var P=Object.defineProperty,O=Object.getOwnPropertyDescriptor,m=(e,t,r,o)=>{for(var s=o>1?void 0:o?O(t,r):t,n=e.length-1,a;n>=0;n--)(a=e[n])&&(s=(o?a(t,r,s):a(s))||s);return o&&s&&P(t,r,s),s};import{Component as I,Prop as w,Vue as R}from"vue-property-decorator";import{Bean as M,ComponentUtil as E,createGrid as b,ALWAYS_SYNC_GLOBAL_EVENTS as y}from"ag-grid-community";import{BaseComponentWrapper as _,Bean as F}from"ag-grid-community";import v from"vue";var f=class{static getComponentType(e,t){if(typeof t=="string"){const r=this.searchForComponentInstance(e,t);return r?v.extend(r):(console.error(`Could not find component with name of ${t}. Is it in Vue.components?`),null)}else return t}static createAndMountComponent(e,t,r){const o={data:{params:Object.freeze(e)},parent:r};r.componentDependencies&&r.componentDependencies.forEach(n=>o[n]=r[n]);const s=new t(o);return s.$mount(),s}static searchForComponentInstance(e,t,r=10,o=!1){let s=null,n=e.$parent,a=0;for(;!s&&n&&n.$options&&++a<r;){const d=n;d.$options&&d.$options.components&&d.$options.components[t]?s=d.$options.components[t]:d[t]&&(s=d[t]),n=n.$parent}return!s&&!o?(console.error(`Could not find component with name of ${t}. Is it in Vue.components?`),null):s}},g=class extends _{constructor(e){super(),this.parent=e}createWrapper(e){const t=this;class r extends A{init(n){super.init(n)}hasMethod(n){return o.getFrameworkComponentInstance()[n]!=null}callMethod(n,a){const d=this.getFrameworkComponentInstance();return o.getFrameworkComponentInstance()[n].apply(d,a)}addMethod(n,a){o[n]=a}overrideProcessing(n){return t.parent.autoParamsRefresh&&n==="refresh"}processMethod(n,a){return n==="refresh"&&(this.getFrameworkComponentInstance().params=a[0]),this.hasMethod(n)?this.callMethod(n,a):n==="refresh"}createComponent(n){return t.createComponent(e,n)}}const o=new r;return o}createComponent(e,t){const r=f.getComponentType(this.parent,e);if(r)return f.createAndMountComponent(t,r,this.parent)}createMethodProxy(e,t,r){return function(){return e.overrideProcessing(t)?e.processMethod(t,arguments):e.hasMethod(t)?e.callMethod(t,arguments):(r&&console.warn("AG Grid: Framework component is missing the method "+t+"()"),null)}}destroy(){this.parent=null}};g=m([F("frameworkComponentWrapper")],g);var A=class{getGui(){return this.component.$el}destroy(){this.getFrameworkComponentInstance()&&typeof this.getFrameworkComponentInstance().destroy=="function"&&this.getFrameworkComponentInstance().destroy(),this.component.$destroy()}getFrameworkComponentInstance(){return this.component}init(e){this.component=this.createComponent(e)}};import{ComponentUtil as u}from"ag-grid-community";var $=()=>{const e={gridOptions:{default(){return{}}},rowDataModel:void 0},t=["context","popupParent"],r=u.ALL_PROPERTIES.filter(i=>!t.includes(i)),o=(i,c)=>{const h={};return i.forEach(l=>{c[l]!==u.VUE_OMITTED_PROPERTY&&(h[l]=c[l])}),h},s=(i,c,h)=>{if(!h.gridCreated||!h.api)return;const l={};Object.entries(c).forEach(([C,D])=>{i[C]!==D&&(l[C]=D)}),u.processOnChange(l,h.api)},n={props(){return o(r,this)},shallowProps(){return o(t,this)}},a={rowDataModel(i,c){!this.gridCreated||!this.api||i!==c&&(i&&c&&i.length===c.length&&i.every((h,l)=>h===c[l])||u.processOnChange({rowData:i},this.api))},props:{handler(i,c){s(c,i,this)},deep:!0},shallowProps:{handler(i,c){s(c,i,this)},deep:!1}};return u.ALL_PROPERTIES.forEach(i=>{e[i]={default:u.VUE_OMITTED_PROPERTY}}),[e,n,a,{prop:"rowDataModel",event:"data-model-changed"}]};import{VanillaFrameworkOverrides as k}from"ag-grid-community";var T=class extends k{constructor(e){super("vue"),this.parent=e}frameworkComponent(e,t){let r=!!f.searchForComponentInstance(this.parent,e,10,!0),o=r?e:null;if(!o&&t&&t[e]){const s=t[e];r=!!f.searchForComponentInstance(this.parent,s,10,!0),o=r?s:null}return o}isFrameworkComponent(e){return typeof e=="object"}},[L,B,V,S]=$(),p=class extends R{constructor(){super(...arguments),this.gridCreated=!1,this.isDestroyed=!1,this.gridReadyFired=!1,this.api=void 0,this.emitRowModel=null}static kebabProperty(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}render(e){return e("div")}globalEventListenerFactory(e){return(t,r)=>{if(this.isDestroyed)return;t==="gridReady"&&(this.gridReadyFired=!0);const o=y.has(t);if(o&&!e||!o&&e)return;this.updateModelIfUsed(t);const s=p.kebabProperty(t);this.$listeners[s]?this.$emit(s,r):this.$listeners[t]&&this.$emit(t,r)}}mounted(){this.emitRowModel=this.debounce(()=>{this.$emit("data-model-changed",Object.freeze(this.getRowData()))},20);const e=new g(this),t=E.combineAttributesAndGridOptions(this.gridOptions,this);this.checkForBindingConflicts();const r=this.getRowDataBasedOnBindings();r!==E.VUE_OMITTED_PROPERTY&&(t.rowData=r);const o={globalEventListener:this.globalEventListenerFactory().bind(this),globalSyncEventListener:this.globalEventListenerFactory(!0).bind(this),frameworkOverrides:new T(this),providedBeanInstances:{frameworkComponentWrapper:e},modules:this.modules};this.api=b(this.$el,t,o),this.gridCreated=!0}destroyed(){var e;this.gridCreated&&((e=this.api)==null||e.destroy(),this.isDestroyed=!0)}checkForBindingConflicts(){const e=this;(e.rowData||this.gridOptions.rowData)&&e.rowDataModel&&console.warn("AG Grid: Using both rowData and rowDataModel. rowData will be ignored.")}getRowData(){var e;const t=[];return(e=this.api)==null||e.forEachNode(r=>{t.push(r.data)}),t}updateModelIfUsed(e){this.gridReadyFired&&this.$listeners["data-model-changed"]&&p.ROW_DATA_EVENTS.has(e)&&this.emitRowModel&&this.emitRowModel()}getRowDataBasedOnBindings(){const e=this,t=e.rowDataModel;return t||(e.rowData?e.rowData:e.gridOptions.rowData)}debounce(e,t){let r;return()=>{const o=function(){e()};window.clearTimeout(r),r=window.setTimeout(o,t)}}};p.ROW_DATA_EVENTS=new Set(["rowDataUpdated","cellValueChanged","rowValueChanged"]),m([w(Boolean)],p.prototype,"autoParamsRefresh",2),m([w({default:()=>[]})],p.prototype,"componentDependencies",2),m([w({default:()=>[]})],p.prototype,"modules",2),p=m([M("agGridVue"),I({props:L,computed:B,watch:V,model:S})],p);export{p as AgGridVue};
